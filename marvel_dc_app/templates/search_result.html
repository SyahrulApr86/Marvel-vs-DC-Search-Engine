{% extends 'base.html' %} {% load static %} {% block meta %}
<title>Search Results - Marvel vs DC</title>
<meta
  name="description"
  content="Search results for your Marvel and DC query. Discover characters, movies, and stories."
/>
{% endblock meta %} {% block content %}
<!-- Enhanced Navbar -->
<nav class="navbar navbar-expand-lg navbar-enhanced fixed-top">
  <div class="container">
    <!-- Brand/logo -->
    <a
      class="navbar-brand fw-bold text-decoration-none"
      href="{% url 'marvel_dc_app:index' %}"
    >
      <span class="marvel-text fs-3">Marvel</span>
      <span class="vs-text fs-3 mx-2">vs</span>
      <span class="dc-text fs-3">DC</span>
    </a>

    <!-- Navbar search -->
    <div class="navbar-nav flex-grow-1 justify-content-center">
      <form
        method="POST"
        action="{% url 'marvel_dc_app:search_result' %}"
        class="d-flex w-100"
        style="max-width: 600px"
      >
        <div class="input-group">
          <input
            name="search"
            id="search-bar"
            class="form-control search-input border-end-0"
            type="search"
            placeholder="Search for heroes, movies, or stories..."
            aria-label="Search"
            value="{{ query|default_if_none:'' }}"
            style="border-radius: 50px 0 0 50px; padding: 12px 24px"
          />
          <button
            class="btn btn-enhanced btn-search border-start-0"
            type="submit"
            style="border-radius: 0 50px 50px 0; padding: 12px 20px"
          >
            <i class="fas fa-search"></i>
          </button>
        </div>
      </form>
    </div>

    <!-- Mobile menu button -->
    <button
      class="navbar-toggler border-0"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarNav"
    >
      <i class="fas fa-bars"></i>
    </button>
  </div>
</nav>

<!-- Main Content -->
<div class="container" style="margin-top: 100px">
  <!-- Search Results Header -->
  <div class="detail-container mb-4">
    <div class="row align-items-center">
      <div class="col-md-8">
        <h2 class="text-gradient mb-2 fw-bold">Search Results</h2>
        <p class="text-muted mb-0">
          {% if query %} Results for "<strong>{{ query }}</strong>" {% else %}
          Showing all results {% endif %}
        </p>
      </div>
      <div class="col-md-4 text-md-end mt-3 mt-md-0">
        <div class="stats-badge">
          <i class="fas fa-chart-bar me-2"></i>
          <strong>{{ sumDocs }}</strong> result{% if sumDocs != 1 %}s{% endif %}
          <span class="text-muted">({{ totalTime }}s)</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Results Grid -->
  {% if data %}
  <div class="row g-4">
    {% for movie in data %}
    <div
      class="col-lg-4 col-md-6 fade-in-up"
      style="animation-delay: {{ forloop.counter0|mul:0.1 }}s;"
    >
      <div class="result-card card h-100 border-0">
        <!-- Movie poster/image -->
        <div class="position-relative overflow-hidden" style="height: 300px">
          {% if movie.image.value %}
          <img
            src="{{ movie.image.value }}"
            class="card-img-top w-100 h-100 object-fit-cover"
            alt="{{ movie.film_name.value }}"
            loading="lazy"
            onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjhmOWZhIi8+CiAgPHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzZjNzU3ZCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pgo8L3N2Zz4K'"
          />
          {% else %}
          <img
            src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjhmOWZhIi8+CiAgPHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzZjNzU3ZCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pgo8L3N2Zz4K"
            class="card-img-top w-100 h-100 object-fit-cover"
            alt="No image available"
          />
          {% endif %}

          <!-- Overlay dengan film type badge -->
          <div class="position-absolute top-0 end-0 m-3">
            {% if movie.film_type.value == "MARVEL" %}
            <span class="badge-enhanced" style="background: var(--marvel-red)">
              <i class="fas fa-mask me-1"></i> Marvel
            </span>
            {% elif movie.film_type.value == "DC" %}
            <span class="badge-enhanced" style="background: var(--dc-blue)">
              <i class="fas fa-shield-alt me-1"></i> DC
            </span>
            {% endif %}
          </div>
        </div>

        <!-- Card Body -->
        <div class="card-body p-4">
          <h5 class="card-title fw-bold mb-3" style="line-height: 1.3">
            {{ movie.film_name.value|truncatechars:40 }}
          </h5>

          <!-- Movie details -->
          <div class="mb-3">
            {% if movie.year.value %}
            <div class="d-flex align-items-center mb-2">
              <i class="icon-enhanced fas fa-calendar-alt"></i>
              <span class="small text-muted">{{ movie.year.value }}</span>
            </div>
            {% endif %} {% if movie.runtime.value %}
            <div class="d-flex align-items-center mb-2">
              <i class="icon-enhanced fas fa-clock"></i>
              <span class="small text-muted"
                >{{ movie.runtime.value }} min</span
              >
            </div>
            {% endif %} {% if movie.imdb_rating.value %}
            <div class="d-flex align-items-center mb-2">
              <i class="icon-enhanced fas fa-star text-warning"></i>
              <span class="small fw-semibold"
                >{{ movie.imdb_rating.value }}/10</span
              >
            </div>
            {% endif %}
          </div>

          <!-- Description -->
          {% if movie.desc.value %}
          <p class="card-text text-muted small mb-3" style="line-height: 1.5">
            {{ movie.desc.value|truncatechars:120 }}
          </p>
          {% endif %}
        </div>

        <!-- Card Footer -->
        <div class="card-footer bg-transparent border-0 p-4 pt-0">
          <form
            action="{% url 'marvel_dc_app:get_film_detail' %}"
            method="post"
            class="w-100"
          >
            <input
              type="hidden"
              name="film_wiki_uri"
              value="{{ movie.film.value }}"
            />
            <button type="submit" class="btn btn-enhanced btn-search w-100">
              <i class="fas fa-info-circle me-2"></i>
              View Details
            </button>
          </form>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Load More Button (if needed) -->
  {% if data|length >= 10 %}
  <div class="text-center mt-5">
    <button
      class="btn btn-outline-secondary btn-enhanced px-4 py-3"
      onclick="loadMoreResults()"
    >
      <i class="fas fa-plus me-2"></i>
      Load More Results
    </button>
  </div>
  {% endif %} {% else %}
  <!-- No Results State -->
  <div class="detail-container text-center py-5">
    <div class="mb-4">
      <i
        class="fas fa-search text-muted"
        style="font-size: 4rem; opacity: 0.3"
      ></i>
    </div>
    <h3 class="text-muted mb-3">No Results Found</h3>
    <p class="text-secondary mb-4">
      We couldn't find any matches for your search. {% if query %} Try searching
      for something else or check your spelling. {% endif %}
    </p>
    <div class="d-flex flex-wrap justify-content-center gap-2">
      <button
        type="button"
        class="btn btn-outline-secondary btn-sm rounded-pill"
        onclick="quickSearch('Batman')"
      >
        <i class="fab fa-dev me-1"></i> Batman
      </button>
      <button
        type="button"
        class="btn btn-outline-secondary btn-sm rounded-pill"
        onclick="quickSearch('Spider-Man')"
      >
        <i class="fas fa-spider me-1"></i> Spider-Man
      </button>
      <button
        type="button"
        class="btn btn-outline-secondary btn-sm rounded-pill"
        onclick="quickSearch('Superman')"
      >
        <i class="fas fa-user-shield me-1"></i> Superman
      </button>
    </div>
  </div>
  {% endif %}
</div>

<!-- Enhanced JavaScript -->
<script>
  // Quick search functionality
  function quickSearch(query) {
    const searchInput = document.getElementById("search-bar");
    searchInput.value = query;
    searchInput.closest("form").submit();
  }

  // Load more results functionality
  function loadMoreResults() {
    // This would typically load more results via AJAX
    alert("Load more functionality would be implemented here");
  }

  // Enhanced card animations on scroll
  const observerOptions = {
    threshold: 0.1,
    rootMargin: "0px 0px -50px 0px",
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        entry.target.style.opacity = "1";
        entry.target.style.transform = "translateY(0)";
      }
    });
  }, observerOptions);

  // Observe all result cards
  document.querySelectorAll(".result-card").forEach((card) => {
    card.style.opacity = "0";
    card.style.transform = "translateY(30px)";
    card.style.transition = "opacity 0.6s ease, transform 0.6s ease";
    observer.observe(card);
  });

  // Search input focus enhancement
  document.addEventListener("DOMContentLoaded", function () {
    const searchInput = document.getElementById("search-bar");

    searchInput.addEventListener("focus", function () {
      this.parentElement.style.transform = "scale(1.02)";
      this.parentElement.style.zIndex = "1050";
    });

    searchInput.addEventListener("blur", function () {
      this.parentElement.style.transform = "";
      this.parentElement.style.zIndex = "";
    });

    // Auto-focus search on page load
    if (!searchInput.value) {
      setTimeout(() => searchInput.focus(), 500);
    }
  });

  // Keyboard navigation
  document.addEventListener("keydown", function (e) {
    if (e.key === "/" && document.activeElement.tagName !== "INPUT") {
      e.preventDefault();
      document.getElementById("search-bar").focus();
    }
  });
</script>

<!-- Additional enhanced styles -->
<style>
  .object-fit-cover {
    object-fit: cover;
  }

  .result-card {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .result-card:hover {
    transform: translateY(-8px) scale(1.02);
  }

  .result-card .card-img-top {
    transition: transform 0.3s ease;
  }

  .result-card:hover .card-img-top {
    transform: scale(1.1);
  }

  .input-group {
    transition: all 0.3s ease;
  }

  .navbar-enhanced {
    transition: all 0.3s ease;
  }

  /* Staggered animation for cards */
  .fade-in-up {
    animation: fadeInUp 0.6s ease-out forwards;
  }

  /* Enhanced responsive design */
  @media (max-width: 768px) {
    .navbar .form-control {
      font-size: 16px; /* Prevent zoom on iOS */
    }

    .result-card {
      margin-bottom: 1.5rem;
    }

    .stats-badge {
      font-size: 0.85rem;
    }
  }

  /* Loading states */
  .btn-enhanced:disabled {
    opacity: 0.7;
    transform: none !important;
  }

  /* Smooth navbar hide/show on scroll */
  .navbar-hidden {
    transform: translateY(-100%);
  }
</style>

<!-- Navbar scroll behavior -->
<script>
  let lastScrollTop = 0;
  const navbar = document.querySelector(".navbar");

  window.addEventListener("scroll", function () {
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

    if (scrollTop > lastScrollTop && scrollTop > 100) {
      // Scrolling down - hide navbar
      navbar.classList.add("navbar-hidden");
    } else {
      // Scrolling up - show navbar
      navbar.classList.remove("navbar-hidden");
    }

    lastScrollTop = scrollTop;
  });
</script>
{% endblock content %}
